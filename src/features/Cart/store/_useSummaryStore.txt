// @ts-nocheck
import { create } from "zustand";

// Helper untuk localStorage
const saveSummaryToLocalStorage = (summary) => {
    localStorage.setItem("summary", JSON.stringify(summary));
};

const getSummaryFromLocalStorage = () => {
    const stored = localStorage.getItem("summary");
    if (stored) {
        try {
            return JSON.parse(stored);
        } catch {
            return null;
        }
    }
    return null;
};

export const useSummaryStore = create((set, get) => ({
    // Inisialisasi summary dari localStorage atau default
    tanggalTransaksi:
        getSummaryFromLocalStorage()?.tanggalTransaksi ||
        new Date().toLocaleDateString("id-ID"),
    metodePembayaran: getSummaryFromLocalStorage()?.metodePembayaran || "Cash",
    customer: getSummaryFromLocalStorage()?.customer || "Umum",
    diskonSubtotal: getSummaryFromLocalStorage()?.diskonSubtotal || 0,
    ppn: getSummaryFromLocalStorage()?.ppn || 0,
    // Tambahan baru
    paidAmount: getSummaryFromLocalStorage()?.paidAmount || 0,
    changeAmount: getSummaryFromLocalStorage()?.changeAmount || 0,

    // Fungsi untuk update field
    setTanggalTransaksi: (tanggal) => {
        set((state) => {
            const newState = { ...state, tanggalTransaksi: tanggal };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    setMetodePembayaran: (metode) => {
        set((state) => {
            const newState = { ...state, metodePembayaran: metode };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    setCustomer: (customerName) => {
        set((state) => {
            const newState = { ...state, customer: customerName };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    setDiskonSubtotal: (diskon) => {
        set((state) => {
            const newState = { ...state, diskonSubtotal: diskon };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    setPPN: (ppnValue) => {
        set((state) => {
            const newState = { ...state, ppn: ppnValue };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    // Setter baru untuk pembayaran
    setPaidAmount: (paid, totalFinal) => {
        set((state) => {
            const newState = {
                ...state,
                paidAmount: paid,
                changeAmount: paid - totalFinal,
            };
            saveSummaryToLocalStorage(newState);
            return newState;
        });
    },

    // Fungsi reset semua summary
    clearSummary: () => {
        const defaultState = {
            tanggalTransaksi: new Date().toLocaleDateString("id-ID"),
            metodePembayaran: "Cash",
            customer: "Umum",
            diskonSubtotal: 0,
            ppn: 0,
            paidAmount: 0,
            changeAmount: 0,
        };
        saveSummaryToLocalStorage(defaultState);
        set(defaultState);
    },
}));
